{% extends "calendar.html" %}

{% block calendar %}

<form action="" method="POST" class="">
    {{ form.hidden_tag() }}
    <table>

        <thead>
            <tr>
                <th></th>
                {% for schedule in schedules %}
                    <th>
                        {{ schedule.day.strftime('%A') }}<br>
                        {{ schedule.day.strftime('%m-%d') }}
                    </th>
                {% endfor %}
            </tr>
        </thead>

        <tbody>
            {% for turn in turns %}
            <tr>
                <td class="workout-time">
                    {{ turn.from_hour.strftime('%H:%M') }}-{{ turn.to_hour.strftime('%H:%M') }}
                </td>
                {% for schedule in schedules %}
                    {% for allturn in allturns %}
                        {% if allturn.day == schedule.day and allturn.from_hour == turn.from_hour and allturn.to_hour == turn.to_hour %}
                            {% for course in courses %}
                                {% if allturn.course_id == course.id %}
                                    {% if flag.update({'flag': False}) %} {% endif %}
                                    <!-- PRINT CELL -->
                                    <td class="hover-bg ts-item">
                                        <h6>{{ course.name }}</h6>
                                        <span>{{ turn.from_hour.strftime('%H:%M') }}-{{ turn.to_hour.strftime('%H:%M') }}</span>
                                        <div class="trainer-name">
                                            {% for your_reservation in your_reservations %}
                                                {% if your_reservation.schedule_course_id == allturn.id %}
                                                    {% if flag_reservation.update({'flag': False}) %} {% endif %}
                                                    You have already reserved a slot
                                                {% endif %}
                                            {% endfor %}
                                            {% if flag_reservation.flag %}
                                                {% for reservation in reservations %}
                                                    {% if reservation.schedule_course_id == allturn.id %}
                                                        {% if flag_slots.update({'flag': False}) %} {% endif %}
                                                        {{ course.max_members - reservation.count }} slots available
                                                        {% if course.max_members - reservation.count <= 0 %}
                                                            {% if flag_checkbox.update({'flag': False}) %} {% endif %}
                                                        {% endif %}
                                                    {% endif %}
                                                {% endfor %}
                                                {% if flag_slots.flag %}
                                                    {{ course.max_members }} slots available
                                                {% endif %}
                                                {% if flag_slots.update({'flag': True}) %} {% endif %}
                                            {% endif %}
                                        </div>
                                        <!-- PRINT CHECKBOX -->
                                        {% if flag_checkbox.flag and flag_reservation.flag %}
                                            <label class="my-checkbox">
                                                {% set checkbox = getattr(form, str(allturn.id)) %}
                                                {{ checkbox }}
                                                <span class="checkmark"></span>
                                            </label>
                                        {% endif %}
                                        {% if flag_checkbox.update({'flag': True}) %} {% endif %}
                                        {% if flag_reservation.update({'flag': True}) %} {% endif %}
                                    </td>
                                {% endif %}
                            {% endfor %}
                        {% endif %}
                    {% endfor %}
                    {% if flag.flag %}
                        <td class="hover-bg ts-item">
                            <!-- EMPTY CELL -->
                        </td>
                    {% endif %}
                    {% if flag.update({'flag': True}) %} {% endif %}
                {% endfor %}
            </tr>
            {% endfor %}
        </tbody>
        
    </table>

    <div class="calendar-submit">
        <div class="calendar-form">
            {{ form.submit(class="register-btn") }}
        </div>
    </div>

</form>

{% endblock %}>